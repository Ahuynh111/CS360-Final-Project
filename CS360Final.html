<!DOCTYPE html>
<html>
  <head>
    <title> CS360 Final Project </title>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-legend/2.25.6/d3-legend.min.js"></script>
    </script>

  </head>
  <style type="text/css">
    .article{
      margin-right: 50px;
      margin-left: 50px;
    }
  </style>
  <body>
    <font color = #5C4033>
    <body bgcolor=#CCC5B5>
      <!-- Section 1: Introduction 
           This section includes all introductory information of 
           assignment, author, and purpose. --> 
  <section id = "introduction" class = "article"> 
    <h1> <center> US Feed Grains - A Visual Exploration</h1>
     <h5>
    <center> <!-- assignment and author info -->
        University of San Francisco | CS360 Data Visualization Final Project <br>
        Annie Huynh | ahuynh8@dons.usfca.edu </em>
    </h5>
    <p> <center> <!-- project purpose info -->
      This site intends to visualize different metrics on feed grains in the United States. The data spans across roughly 30 years given by the United States Department of Agriculture. While the dataset offers data for a handful of different feed grains, this project will only focus on corn, barley, sorghum, and oats. This project does not intend to completely educate on the United State's feed grain economy, but rather give a very general statistical overview through data visualization. We intend to answer the following:
    </p>
    <p><center> <!-- project objectives/primary questions -->
      1. How have prices changed across three decades?
      <br>
      2. How does growth look like overtime for each feed grain yield in the US?
      <br>
      3. How have US imports and exports changed across three decades?
      
    </p>
  </section>
      <!-- Section 2: Prices 
           This section holds the first visual plotting prices for each feed grain over time using a scatter plot.
           This section utilizes d3 hovering mechanics as well as tool tips. --> 
  <section id = "prices" class = "article">
    <div id = "pricesDIV"></div>
      <script >
      //Scatter Plot of Pricing Information Over Time
      //SVG setup
      var svgH = 650;
      var svgW = 1300;
      var margins = {top: 100, bottom: 100, left: 100, right: 100};
      var pad = 50
      var H = 500
      var W = 600

      var svgTime = d3.select("#pricesDIV")
        .append("svg")
        .attr("height", svgH)
        .attr("width", svgW);

      var graphTime = svgTime.append("g")
        .attr("transform", `translate(${margins.left}, ${margins.top})`);

        //Import Data 
        d3.csv('https://raw.githubusercontent.com/Ahuynh111/CS360-Final-Project/main/pricingInformation.csv', function(d){
          return{
            Type: d.type,
            Price: +d.weightedAveragePrice,
            Date: d3.timeParse("%Y")(d.Years)
          };
        }).then(function(d1){
          
        //scales
          var timeScale = d3.scaleTime()
            .domain(d3.extent(d1, function(z){
              return(z.Date)
            }))
            .range([0,W]);

          var priceScale = d3.scaleLinear()
            .domain([0, d3.max(d1, function(z){
              return(z.Price)
            })])
            .range([H,0]);

        //Color and Legend
        var colorScale = d3.scaleOrdinal()
          .domain(["Barley", "Corn", "Oat", "Sorghum"])
          .range(["#d45800", "#c88435", "#400000", "#83766c"])

        var legend = d3.legendColor()
          .shape('rect')
          .shapeWidth(10)
          .shapeHeight(10)
          .shapePadding(10)
          .labelOffset(5)
          .labelWrap(30)
          .orient('vertical')
          .scale(colorScale)

        graphTime.append("g")
          .attr("transform", `translate(${W + 50}, ${H - 500})`)
          .call(legend);
            
          //axes
            graphTime.append("g")
              .attr("transform", `translate(0,${H})`)
              .call(d3.axisBottom(timeScale).ticks(10));

            graphTime.append("g")
              .attr("transform", `translate(0,0)`)
              .call(d3.axisLeft(priceScale).ticks(10));


          //tool tips 
          var tool = d3.select("#pricesDIV")
              .data(d1)
              .enter()
              .append("div")
              .style("opacity", 1)
              .html("Hover over each point!")
              .style("left", svgW/2 +350 + "px")
              .style("top",  H + 100 + "px")
              .attr("class", "tooltip")
              .style("position", "absolute")
              .style("background-color", "#CCC5B5")
              .style("border", "none")
              .style("border-color", "#5C4033")
              .style("padding", "10px")
              .style("font-size", "20px")
              .style("color", "#5C4033")

    
          //plotting
          graphTime.selectAll(".circle")
            .data(d1)
            .enter()
            .append("circle")
            .attr("class", "circle")
            .attr("cx", function(z){
              return(timeScale(z.Date))
            })
            .attr("cy", function(z){
              return(priceScale(z.Price))
            })
            .attr("r", 3)
            .attr("fill", function(z){
              return(colorScale(z.Type))
            })
            .on('mouseover', function(z){
                d3.selectAll(".circle")
                  .attr("opacity", 0.25)
                d3.select(this)
                  .attr("r", 8)
                  .attr("opacity", 1)
                tool
                  .style("opacity", 1)
                d3.select(this)
                  .style("visibility", "visible")
                  .html(z.Average)
              })
              .on('mouseout', function(z){
                d3.selectAll(".circle")
                  .attr("opacity", 1)
                d3.select(this)
                  .attr("r", 3)
                tool
                  .style("opacity", 1)
                d3.select(this)
              })
            .on("mousemove", function(e,z){
              condensedDate = String(z.Date).substring(11,15)
              tool
                .html("Average Price of " + z.Type + " in " + condensedDate +": $" + z.Price +"/bushel")
                .style("left", svgW/2 +300 + "px")
                .style("top",  H + 100 + "px")
                .style("opacity", 1)
            })

          //labels
            graphTime.append("text")
              .text("Price")
              .attr("x", -75)
              .attr("y", H/2);
            graphTime.append("text")
              .html("Weighted Average Price Over Time (US Dollar/Bushel)")
              .attr("x", W - 500)
              .attr("y", -30)
      })
      </script>
      <article>
      <p>The average weighted price for each of the four grains grows exponentially over time. Every grain's price follows the same growth pattern including the peaks at the 1920s, mid 1940s, and the steady growth 1980s onwards. Overall, there is a positive correlation between time and price per bushel increase that is consistent across all grains. This may be correlated to inflating prices in all economic sectors, and insinuates higher demand due to a the evergrowing population.</p>
      <p> The data has been processed through relabelling of years to just reflect the starting year of the agricultural period. The average weighted price per bushel for each grain was selected out of the two tables and combined into one larger csv file in R.</p>
      </article>
  </section>
      <!-- Section 3: Farming 
           This section holds the second visual plotting grain yield for each feed grain, except sorghum, over time using a line graph.
           This section utilizes d3 dragging mechanics as well as tool tips.
           Function: statement()
                Given a year input, statement() will provide list of text of historical events of the decade
                the given year is from. Users cannot access this function and is only used internally. 
           Function: currentYear()
                Given time data, currentYear() will take four characters that correspond to the year and return a string of the 4 numbers. Users cannot access this function and is only used internally. --> 
  <section id = farming class = "article">
    <div id = "farmingDIV">
      <script>
        //SVG setup
      var svgHFarm = 650;
      var svgWFarm = 1300;
      var margins = {top: 100, bottom: 100, left: 100, right: 100};
      var pad = 50
      var HFarm = 500
      var WFarm = 600

      var svgFarm = d3.select("#farmingDIV")
        .append("svg")
        .attr("height", svgHFarm)
        .attr("width", svgWFarm);

      var graphLine = svgFarm.append("g")
        .attr("transform", `translate(${margins.left}, ${margins.top})`);

      //Import Data --> no Sorghum due to lack of data
        d3.csv('https://raw.githubusercontent.com/Ahuynh111/CS360-Final-Project/main/FarmingInformation.csv', function(d){
          return{
            Yield: +d.yieldBushelsAcre,
            Type: d.type,
            Date: d3.timeParse("%Y")(d.startingYear)
          };
        }).then(function(d1){


          //group data
          groupData = d3.group(d1, function(z){
            return(z.Type)
          })
          

          //scales
          var timelineScale = d3.scaleTime()
            .domain(d3.extent(d1, function(z){
              return(z.Date)
            }))
            .range([0,WFarm]);

          var yieldScale = d3.scaleLinear()
            .domain([0, d3.max(d1, function(z){
              return(z.Yield)
            })])
            .range([HFarm,0]);

        //Color and Legend
        var colorLine = d3.scaleOrdinal()
          .domain(["Barley", "Corn", "Oat"])
          .range(["#d45800", "#c88435", "#400000", "#83766c"])

        var legendLine = d3.legendColor()
          .shape('rect')
          .shapeWidth(10)
          .shapeHeight(10)
          .shapePadding(10)
          .labelOffset(5)
          .labelWrap(30)
          .orient('vertical')
          .scale(colorLine)

          //tool tips 
          var toolFarm1 = d3.select("#farmingDIV")
              .data(d1)
              .enter()
              .append("div")
              .html("Move brown line to select a year!")
              .style("left", svgWFarm/2 +350 + "px")
              .style("top",  HFarm + 900 + "px")
              .style("opacity", 1)
              .attr("class", "tooltip")
              .style("position", "absolute")
              .style("background-color", "#CCC5B5")
              .style("border", "none")
              .style("border-color", "#5C4033")
              .style("padding", "10px")
              .style("font-size", "20px")
              .style("color", "#5C4033")

            var toolFarm2 = d3.select("#farmingDIV")
              .data(d1)
              .enter()
              .append("div")
              .style("opacity", 1)
              .attr("class", "tooltip")
              .style("position", "absolute")
              .style("background-color", "#CCC5B5")
              .style("border", "none")
              .style("border-color", "#5C4033")
              .style("padding", "10px")
              .style("font-size", "20px")
              .style("color", "#5C4033")

        graphLine.append("g")
          .attr("transform", `translate(${WFarm + 50}, ${HFarm - 500})`)
          .call(legendLine);
            
          //axes
            graphLine.append("g")
              .attr("transform", `translate(0,${HFarm})`)
              .call(d3.axisBottom(timelineScale));

            graphLine.append("g")
              .attr("transform", `translate(0,0)`)
              .call(d3.axisLeft(yieldScale).ticks(10));
    
          //plotting
           var path = d3.line()
              .x(function(z){
                return(xScale(z.Date));
              })
              .y(function(z){
                return(yScale(z.Yield));
              })

            graphLine.selectAll(".line")
              .data(groupData)
              .join("path")
              .attr("year", function(z){
                return z.Date
              })
              .attr("stroke", function(z){
                return colorLine(z[0])
              })
              .attr("stroke-width", 2)
              .attr("d", function(z){
                return d3.line()
                  .x(function(x){
                    return(timelineScale(x.Date))
                  })
                  .y(function(y){
                    return(yieldScale(y.Yield))
                  })
                  (z[1])
              })
              .attr("fill", "none")
              .on('mouseover', function(z){
                d3.selectAll(".line")
                .attr("opacity", 0.25)
                d3.select(this)
                .attr("stroke-width", 3.5)
              })
              .on('mouseout', function(z){
                d3.selectAll(".line")
                  .attr("opacity", 1)
                d3.select(this)
                  .attr("stroke-width", 2)
              })

          //labels
            graphLine.append("text")
              .text("Bushels")
              .attr("x", -85)
              .attr("y", HFarm/2);
            graphLine.append("text")
              .text("Average Yield Over Time (Bushels/Acre)")
              .attr("x", WFarm/2 - 100)
              .attr("y", -30)

          //helpful functions

            var currentYear = function(x){
                if (String(timelineScale.invert(x)).substring(11,15) > 2023){
                  return 2023
                }else if(String(timelineScale.invert(x)).substring(11,15) <1865){
                  return 1865
                }else{
                  return(String(timelineScale.invert(x)).substring(11,15))                  }
                }

            const statement = function(v){
              z = currentYear(v)
              if(z>1800 && z <=1880){
                return("<b>Historical Events <br><br> </b>American Civil War 1861-1865<br><br>Department of Agriculture Founded 1862<br><br>Industrialization in the US 1865 - 1889")
              }else if (z > 1880 && z <= 1890){
                return("<b>Historical Events <br><br> </b>Assassination of James Garfield 1881<br><br>Statue of Liberty given to US  by France 1885")
              }else if(z > 1890 && z <= 1900){
                return("<b>Historical Events <br><br> </b>Panic of 1893<br><br>Plessy V. Ferguson 1896<br><br>Spanish-American War 1898")
              }else if(z > 1900 && z <= 1910){
                return("<b>Historical Events <br><br> </b>Reclamation Act 1902<br><br>Pure Food and Drug Act 1906<br><br>San Francisco Earthquake 1906")
              }else if(z > 1910 && z <= 1920){
                return("<b>Historical Events <br><br> </b>Start of WWI 1914<br><br>Start of Hybrid Corn 1915<br><br>Biotechnology 1919")
              }else if(z > 1920 && z <= 1930){
                return("<b>Historical Events <br><br> </b>Roaring 20s 1920-1929<br><br>End of WWI 1921<br><br>Start of Great Depression 1929")
              }else if(z > 1930 && z <= 1940){
                return("<b>Historical Events <br><br> </b>New Deal 1933-1939<br><br>Agricultural Adjustment Act 1933<br><br>Dust Bowl 1934")
              }else if(z > 1940 && z <= 1950){
                return("<b>Historical Events <br><br> </b>US Involvement in WWII 1941<br><br>End of WWII 1945")
              }else if(z > 1950 && z <= 1960){
                return("<b>Historical Events <br><br> </b>Korean War 1950 - 1953<br><br>Agricultural Research Service Founded 1953")
              }else if(z > 1960 && z <= 1970){
                return("<b>Historical Events <br><br> </b>Vietnam War Starts 1964<br><br>Food Stamp Act 1964<br><br>Food and Agriculture Act 1965")
              }else if(z > 1970 && z <= 1980){
                return("<b>Historical Events <br><br> </b>Clean Water Act 1972<br><br>Vietnam War Ends 1975")
              }else if(z > 1980 && z <= 1990){
                return("<b>Historical Events <br><br> </b>Agricultural Credit Act 1987<br><br>Major US Drought 1988<br><br>Global Warming Concerns 1988")
              }else if(z > 1990 && z <= 2000){
                return("<b>Historical Events <br><br> </b>Start of GMO Produce 1994<br><br>Freedom to Farm Act 1995")
              }else if(z > 2000 && z <= 2010){
                return("<b>Historical Events <br><br> </b>September 11th Attack 2001<br><br>The Great Recession 2007-2009")
              }else if(z > 2010 && z <= 2020){
                return("<b>Historical Events <br><br> </b>Hurricanes 2012-2017<br><br>Federal Agriculture Reform and Risk Management Act 2013")
              }else if(z > 2020){
                return("<b>Historical Events <br><br> </b>Start of Coronavirus Lockdown 2020")
              }
            }



          //line interaction
            const line = graphLine.append("line")
              .attr("stroke", "#5C4033")
              .attr("stroke-width", 4)
              .attr("opacity", "0.5")
              .attr("x1", WFarm/2)
              .attr("x2", WFarm/2)
              .attr("y1", 0)
              .attr("y2", HFarm)
              .call(d3.drag().on("drag", function(z){
                  line.attr("x1", function(){
                    if (z.x > WFarm){
                      return WFarm
                    }else if(z.x < 0){
                      return 0
                    }else{
                      return z.x
                    }
                  })
                  line.attr("x2", function(){
                    if (z.x > WFarm){
                      return WFarm
                    }else if(z.x < 0){
                      return 0
                    }else{
                      return z.x
                    }
                  })
                  toolFarm1
                    .html("<b>Current Year: " + currentYear(z.x)) 
                    .style("left", WFarm/2 + 90 + "px")
                    .style("top",  HFarm + 550 + "px")
                    .style("opacity", 1)
                  toolFarm2
                    .html(statement(z.x))
                    .style("left", svgWFarm/2 +300 + "px")
                    .style("top",  HFarm + 800 + "px")
                    .style("opacity", 1)
                }))
        })
      </script>
      <p>Average Yield over time has a positive correlation starting at about the 1960s and onwards. We can see a generally positive growth trend for all grain yields included. At the data's earliest in the 1800s to the beginning of the 1960s, we cann see that grain yiels stayed at about twenty to thirty bushels per acre. However, this may due to lack of data or lack of quality data collection. Interestingly, grain yield for corn grew the most and had the steepest trend overall. Barley and oats followed one another very closely. Sorghum was ommited from this chart due to lack of data.</p>
  </section>
      <!-- Section 4: Imports and Exports  
           This section holds the third visual plotting imports and exports of each grain. Imports and exports have their own separate bar graphs.
           This section utilizes d3 dragging mechanics.
           Function: currentYear()
                Given time data, currentYear() will take four characters that correspond to the year and return a string of the 4 numbers. Users cannot access this function and is only used internally.
           Function redraw()
                When called, redraw will recreate the both bar graphs based on the given year. Users cannot access this function and is only used internally. -->
  <section id = ie >
    <div id = "ieDIV" class = "article">
      <script>
      //Bar Chart of US Imports and US Exports 
      //SVG setup
      var svgHBar = 550;
      var svgWBar = 1300;
      var marginsBar = {top: 100, bottom: 100, left: 100, right: 100};
      var HBar = 250
      var WBar = 1000
      var padding = 50;

      var svgBar = d3.select("#ieDIV")
        .append("svg")
        .attr("height", svgHBar)
        .attr("width", svgWBar);

      var graphBar = svgBar.append("g")
        .attr("transform", `translate(${marginsBar.left + 75},${marginsBar.top})`);
          //Import Data
        d3.csv('https://raw.githubusercontent.com/Ahuynh111/CS360-Final-Project/main/Exports.csv', function(d){
          return{ 
            Date: d3.timeParse("%Y")(d.Years),
            Annual: +d.Annual,
            Type: d.type
          };
        }).then(function(d1){
          d3.csv(`https://raw.githubusercontent.com/Ahuynh111/CS360-Final-Project/main/Imports.csv`, function(t){
            return{
              Date: d3.timeParse("%Y")(t.Years),
              Annual: +t.Annual,
              Type: t.type
            }
          }).then(function(t1){


          //scales
           // Y-axis - Grain type
            grainScale = d3.scaleBand()
              .domain(d1.map(function(z){
                return(z.Type)
              }))
              .range([0,HBar]);

            //Exports
              exportScale = d3.scaleLinear()
                .domain([0, d3.max(d1, function(z){
                  return(z.Annual)
                })])
                .range([0, WBar/2]);

            //Imports 
              importScale = d3.scaleLinear()
                .domain([0, d3.max(t1, function(z){
                  return(z.Annual)
                })])
                .range([0, WBar/2]);

          //append axes
               //exports
            graphBar.append("g")
              .attr("transform", `translate(0, 0)`)
              .call(d3.axisLeft(grainScale));

            graphBar.append("g")
              .attr("transform", `translate(0, ${HBar})`)
              .call(d3.axisBottom(exportScale).ticks(5));

              //imports
            graphBar.append("g")
              .attr("transform", `translate(${WBar/2+ padding}, 0)`)
              .call(d3.axisLeft(grainScale));

           graphBar.append("g")
              .attr("transform", `translate(${WBar/2 + padding}, ${HBar})`)
              .call(d3.axisBottom(importScale).ticks(5));


            //initial current year
            var current = "1990" //default to 1990

                //exports
                  filteredExportData = d1.filter(function(z){
                    if(String(z.Date).substring(11,15) == current){
                      return(z)
                    }
                  })
                  var exportsBars = graphBar.selectAll(".rectExport")
                    .data(filteredExportData)
                    .enter()
                    .append("rect")
                    .attr("class", "rectExport")
                    .attr("x", 0)
                    .attr("y", function(z){
                      return(grainScale(z.Type))
                    })
                    .attr("height", 50)
                    .attr("width", function(z){
                      return(exportScale(z.Annual))
                    })
                    .attr("fill", "#5C4033")

                //imports
                  filteredImportData = t1.filter(function(z){
                    if(String(z.Date).substring(11,15) == current){
                      return(z)
                    }
                  })
                  var importsBars = graphBar.selectAll(".rectImport")
                    .data(filteredImportData)
                    .enter()
                    .append("rect")
                    .attr("class", "rectImport")
                    .attr("x", WBar/2 + padding)
                    .attr("y", function(z){
                      return(grainScale(z.Type))
                    })
                    .attr("height", 50)
                    .attr("width", function(z){
                      return(importScale(z.Annual))
                    })
                    .attr("fill", "#5C4033")


            //redrawing when current year changes
            const redraw = function(x){
              filteredExportData = d1.filter(function(z){
                if(String(z.Date).substring(11,15) == x){
                  return(z)
                }
              })
              filteredImportData = t1.filter(function(z){
                if(String(z.Date).substring(11,15) == x){
                  return(z)
                }
              })

              graphBar.selectAll(".rectExport").remove()
              var exportsBars = graphBar.selectAll(".rectExport")
                    .data(filteredExportData)
                    .enter()
                    .append("rect")
                    .attr("class", "rectExport")
                    .attr("x", 0)
                    .attr("y", function(z){
                      return(grainScale(z.Type))
                    })
                    .attr("height", 50)
                    .attr("width", function(z){
                      return(exportScale(z.Annual))
                    })
                    .attr("fill", "#5C4033")
              graphBar.selectAll(".rectImport").remove()
              var importsBars = graphBar.selectAll(".rectImport")
                    .data(filteredImportData)
                    .enter()
                    .append("rect")
                    .attr("class", "rectImport")
                    .attr("x", WBar/2 + padding)
                    .attr("y", function(z){
                      return(grainScale(z.Type))
                    })
                    .attr("height", 50)
                    .attr("width", function(z){
                      return(importScale(z.Annual))
                    })
                    .attr("fill", "#5C4033")
            }

            //year sliding tools
            var time = d3.scaleTime()
              .domain(d3.extent(d1, function(z){
                return (z.Date)
              }))
              .range([svgWBar/4, svgWBar/2])

            var currentYear = function(x){
                if(String(time.invert(x)).substring(11,15) > 2023){
                  return 2023
                }else if(String(time.invert(x)).substring(11,15) < 1990){
                  return 1990
                }else{
                  return String(time.invert(x)).substring(11,15)
                }
              }

            graphBar.append("g")
              .attr("transform", `translate(${svgWBar - 1300}, 400)`)
              .call(d3.axisBottom(time).ticks(5));

            //yearLabel
            var yearLabel = d3.select("#ieDIV")
              .append("div")
              .style("opacity", 1)
              .attr("class", "tooltip")
              .style("position", "absolute")
              .style("background-color", "#CCC5B5")
              .style("border", "none")
              .style("border-color", "#5C4033")
              .style("padding", "10px")
              .style("font-size", "20px")
              .style("color", "#5C4033")
              .html(current)
              .style("left", svgWBar/2 + 50 + "px")
              .style("top",  svgHBar + 1700 + "px")

            const circle = graphBar.append("circle")
              .attr("stroke", "#CC5500")
              .attr("fill", "#CC5500")
              .attr("r", 4)
              .attr("cx", svgWBar/4)
              .attr("cy", 400)
              .call(d3.drag().on("drag", function(z){
                  circle.attr("cx", function(){
                    if (z.x > svgWBar/2 ){
                      return svgWBar/2
                    }else if(z.x < svgWBar/4){
                      return svgWBar/4
                    }else{
                      return z.x
                    }
                  })
                current = currentYear(z.x)
                yearLabel
                  .html(current)
                redraw(current)
                }))


          //labels
            graphBar.append("text")
              .text("Exports From US")
              .attr("x", WBar - 800)
              .attr("y", -20)
           graphBar.append("text")
              .text("Total Bushels")
              .attr("x", WBar - 800)
              .attr("y", HBar + 75)

            graphBar.append("text")
              .text("Imports to US")
              .attr("x", WBar - 225)
              .attr("y", -20)

            graphBar.append("text")
              .text("Total Bushels")
              .attr("x", WBar - 225)
              .attr("y", HBar + 75)
          })
        })
      </script>

      <p>On the left we have exports of each grain from the US, and on the right, we have imports of each grain to the US. Both data sets include data from 1990 to the most recent recorded year 2023. Starting with exports, we can see that corn is the leading exported grain across every recorded year. In 1991, corn exports grew tremendously, and have since generally continued to grow with a bit of fluctuation. All other grains fluctuate as well. However, none come close to the growth of corn and stay below 500,000,000 total bushels across all three decades. Following corn, sorghum generally remains the second highest exported grain with barley and oats trailing behind respectively. 
      </p>
      <p>
        As for the imports side, we see a completely opposite trend, as expected. Oats, generally remains the highest imported grain across all decades. Most likely due to the lack of supply as indicated by little to no oat exports. Corn and barley, respectively, follow oats in total number of bushel imports. Interstingly, corn is the highest recorded imports in 2012, but quickly falls behind oats again in the following years. Sorghum also remains the lowest number of imports overtime as it did for exports. This may be due to the lack of sorghum consumed/demanded in the US.
      </p>
      <p>
        Looking above to the yield chart, we can see why corn is the highest in exports. Corn yield had the highest growth above barley and oat. Barley and oats had very similar yields and relatively stay similar in terms of exports. 
      </p>
  </section>
     <!-- Section 5: Corn Exports 
           This section holds the fourth visual plotting exports of corn in a heatmap with other select countries.
           This section utilizes d3 hovering mechanics and tooltips. -->
  <section id = cornHeat >
      <div id = "cornHeatDiv">
        <script>
          //Heat map of corn exports for the US and select countries
          //SVG Setup
          var svgHHeat = 650;
          var svgWHeat = 1300;
          var marginsHeat = {top: 100, bottom: 100, left: 150, right: 100};
          var HHeat = 500
          var WHeat = 1200

          var svgHeat = d3.select("#cornHeatDiv")
            .append("svg")
            .attr("height", svgHHeat)
            .attr("width", svgWHeat);

          var graphHeat = svgHeat.append("g")
            .attr("transform", `translate(${-marginsHeat.left/2},${marginsHeat.top})`);

          //Import Data
        d3.csv('https://raw.githubusercontent.com/Ahuynh111/gist-practice/main/cornWorldExports.csv', function(d){
          return{ 
            Exports: +d.Exports * 1000,
            Country: d.Country, 
            Date: d.Year
          };
        }).then(function(d1){

          //filtering data to remove non-similar countries 
          filteredData = d1.filter(function(z){
              if(z.Date > 1990 && z.Country != "Total" && z.Country != "South Africa" && z.Country != "Paraguay" && z.Country != "European Union" && z.Country != "Russia"){
                return(z)
              }
            })
          console.log(filteredData);

          //scales
            var exportCorn = d3.scaleBand()
            .domain(filteredData.map(function(z){
              return(z.Date)
            }))
            .range([20,svgWHeat - 350]);

            var country = d3.scaleBand()
            .domain(filteredData.map(function(z){
              return(z.Country)
            }))
            .range([HHeat,0]);

          //axes
            graphHeat.append("g")
              .attr("transform", `translate(125,${HHeat})`)
              .call(d3.axisBottom(exportCorn).ticks(12));

            graphHeat.append("g")
              .attr("transform", `translate(145,0)`)
              .call(d3.axisLeft(country).ticks(10));

          //color scale
            var colorScale = d3.scaleThreshold()
              .domain([0,20000000, 30000000, 40000000, 50000000, 60000000, 70000000, 80000000])
              .range(["#fff5eb", "#fee6ce", "#fdd0a2", "#fdae6b", "#fd8d3c", "#f16913", "#d94801","#8c2d04"])

          //color legend
            var legend = d3.legendColor()
              .shapeWidth(10)
              .shapeHeight(10)
              .shapePadding(5)
              .labelFormat(".2s")
              .labelOffset(5)
              .title("Metric Tons")
              .orient("vertical")
              .scale(colorScale);
              
            graphHeat.append("g")
              .attr("transform", `translate(${svgWHeat - 200},50)`)
              .call(legend);

          //tooltips
            var cornTool = d3.select("#cornHeatDiv")
              .append("div")
              .style("opacity", 1)
              .html("Hover over the boxes!")
              .style("left", WHeat/2 + 550 + "px")
              .style("top", 2950+ "px")
              .attr("class", "tooltip")
              .style("position", "absolute")
              .style("background-color", "#CCC5B5")
              .style("border", "none")
              .style("border-color", "#5C4033")
              .style("padding", "10px")
              .style("font-size", "20px")
              .style("color", "#5C4033")


          //plotting
            graphHeat.selectAll(".rect")
              .data(filteredData)
              .enter()
              .append("rect")
              .attr("class", "rect")
              .attr("x", function(z){
                return(exportCorn(z.Date))
              })
              .attr("y", function(z){
                return(country(z.Country))
              })
              .attr("width",exportCorn.bandwidth() - 2)
              .attr("height",country.bandwidth() - 2)
              .attr("transform", `translate(126,1)`)
              .attr("fill", function(z){
                return(colorScale(z.Exports))
              })
              .on('mouseover', function(z){
                cornTool
                .style("opacity", 1)
                d3.select(this)
                .style("visibility", "visible")
                .html(z.Country)
              })
              .on('mouseout', function(z){
                cornTool
                .style("opacity", 0)
                d3.select(this)
              })
              .on('mousemove', function(e, z){
                cornTool
                .html("<center>" + z.Date  + " </center> " + z.Country + ":  "+  d3.format(",")(z.Exports))
                .style("left", WHeat/2 + 570 + "px")
                .style("top", 3050+ "px")
              })

              //labels
            svgHeat.append("text")
              .text("Corn Exports - Select Countries")
              .attr("x", WHeat/2 - 150)
              .attr("y", 70)
        })
        </script>
        <p>
          Continuing with the United State's significance in corn exports, we decided to show where the US stands amongst select countries over time. We can see that the United States dominates above the other countries, and have primarily been the leading exporter since 1990s. However, this may be due to lack of data collection ability overseas 30 years ago. We can see that beginning in 2012, Brazil, Ukraine, and Argentina increase exports. While they don't match with the United States, we can expect a closer competition in future years as there seems to be a positive correlation with exports and each consecutive year.
        </p>
  </section>
    <!-- Section 6: Introduction 
         This section includes all outro information of 
         methodology and sources for all historical events shown on the website. --> 
  <section id = outro>
      <h3> <center>Methodology</h3>
    <p><center>
    The data collection is credited to the Economic Research Service of the Department of Agriculture (USDA) who provided the vast database on their website <a href ="https://www.ers.usda.gov/data-products/feed-grains-database/feed-grains-yearbook-tables/#Zipped%20CSV%20files"> USDA Feed Grains: Yearbook Tables </a>. Due to lack of time and project needs, the data used on this site is condensed from the original database through Numbers and cleaned through R-Studio. Data cleaning and filtering included condensing agricultural years down to the initial year to avoid clutter and for simplicity. In R-studio, we utilized the tidyverse library and stringr library. Individual tables for each grain were worked on and combined into a larger CSV file for the specific category (i.e prices). The original 35 tables have been filtered down into the 11 most relevent.
    </p>
    <p><center>
    Table 1: Farming Information
    <br>
    Tables 4-7: Supply and Disappearance
    <br>
    Tables 9-10: Farmer Prices
    <br>
    Tables 18-19: US Exports
    <br>
    Tables 20-21: US Imports
    </p>
      <h3> <center>Historical Dates Sources</center></h3>
    <p align = left> <font size = 1>
      1. “14 Major Events of the 2010s.” History.Com, A&E Television Networks, <a href = https://www.history.com/news/2010s-decade-major-events>www.history.com</a>. <br>
      2. “26 Decade-Defining Events in U.S. History.” Encyclopædia Britannica, Encyclopædia Britannica, inc., <a href = https://www.britannica.com/story/25-decade-defining-events-in-us-history>www.britannica.com</a>. <br>
      3. “About the U.S. Department of Agriculture.” USDA, <a href = https://www.usda.gov/our-agency/about-usda#:~:text=On%20May%2015%2C%201862%2C%20President,economic%20development%2C%20science%2C%20natural%20resource>https://www.usda.gov</a>.<br>
      4. Agricultural Adjustment Act - New Georgia Encyclopedia, <a href = https://www.georgiaencyclopedia.org/articles/business-economy/agricultural-adjustment-act/>www.georgiaencyclopedia.org</a>. <br>
      5. “American Civil War.” Encyclopædia Britannica, Encyclopædia Britannica, inc., <a href = https://www.britannica.com/event/American-Civil-War>www.britannica.com</a>. <br>
      6. America’s Wars, <a href = https://www.va.gov/opa/publications/factsheets/fs_americas_wars.pdf>www.va.gov</a>. 
      7. Center for Food Safety and Applied Nutrition. “Science and History of Gmos and Other Food Modification Processes.” U.S. Food and Drug Administration, FDA, <a href = https://www.fda.gov/food/agricultural-biotechnology/science-and-history-gmos-and-other-food-modification-processes#:~:text=1994%3A%20The%20first%20GMO%20produce,safe%20as%20traditionally%20bred%20tomatoes>www.fda.gov</a>. <br>
      8. “Climate Change History.” History.Com, A&E Television Networks, <a href = https://www.history.com/topics/natural-disasters-and-environment/history-of-climate-change#1988-global-warming-gets-real>www.history.com</a>. <br>
      9. Downsizinggovernment.org, <a href = https://www.downsizinggovernment.org/agriculture/timeline>www.downsizinggovernment.org</a>. <br>
      10. “The End of World War II 1945: The National WWII Museum: New Orleans.” The National WWII Museum | New Orleans, 7 May 1970, <a href = https://www.nationalww2museum.org/war/topics/end-world-war-ii-1945#:~:text=Truman%20announced%20Japan’s%20surrender%20and,Japan%20Day%20(V%2DJ%20Day)>www.nationalww2museum.org</a>. <br>
      11. EPA, Environmental Protection Agency, <a href = https://www.epa.gov/laws-regulations/summary-clean-water-act>www.epa.gov</a>. <br>
      12. “Explore by Timeline.” GSA, <a href = https://www.gsa.gov/real-estate/historic-preservation/explore-historic-buildings/explore-by-timeline>www.gsa.gov</a>. <br>
      13. “The Federal Civil Service and the Death of President James A. Garfield (U.S. National Park Service).” National Parks Service, U.S. Department of the Interior, <a href = https://www.nps.gov/articles/000/the-federal-civil-service-and-the-death-of-president-james-a-garfield.htm>www.nps.gov</a>. <br>
      14. “The Federal Register.” Federal Register :: Request Access, <a href = https://www.federalregister.gov/agencies/agricultural-research-service#:~:text=The%20 Agricultural%20Research%20Service%20(ARS,Department%20of%20Agriculture%20(USDA)>www.federalregister.gov</a>. <br>
      15. “Food Stamp Act.” California Homeless Education and Technical Assistance Center, <a href = https://www.hetac.org/statutes/federal/fsa#:~:text=The%20Food%20Stamp%20Act%20authorizes,and%20move%20towards%20self%2Dsufficiency>www.hetac.org</a>. <br> 
      16. GovInfo, <a href = https://www.govinfo.gov/app/details/COMPS-12449>www.govinfo.gov</a>. <br>
      17. H.R.2195 - 104th Congress (1995-1996): Freedom To Farm Act of 1995 | Congress.Gov | Library of Congress, <a href = https://www.congress.gov/bill/104th-congress/house-bill/2195>www.congress.gov</a>. <br>
      18. “Historical View of U.S. Agriculture: Crop Protections, Sustainability, and Pesticide Policy.” CropLife America, <a href = https://www.croplifeamerica.org/history>www.croplifeamerica.org</a>. <br>
      19. “House Committee on Agriculture.” House Committee On Agriculture, Chairman GT Thompson, <a href = https://agriculture.house.gov/>agriculture.house.gov</a>. <br>
      20. Jason Gauthier, History Staff. “1900 Fast Facts - History - U.S. Census Bureau.” United States Census Bureau, <a href = https://www.census.gov/history/www/through_the_decades/fast_facts/1900_fast_facts.html>www.census.gov</a>. <br>
      21. McNamara, Robert. “Timeline of Noteworthy Events of the 1890s.” ThoughtCo, ThoughtCo, 28 Feb. 2021, <a href = https://www.thoughtco.com/timeline-from-1890-to-1900-1774042>www.thoughtco.com</a>. <br>
      22. “National Reclamation Act (1902).” The Oregon Encyclopedia, <a href = https://www.oregonencyclopedia.org/articles/national_reclamation_act_1902_/#:~:text=Sometimes%20referred%20to%20as%20the,lands%20to%20finance%20the%20projects>www.oregonencyclopedia.org</a>. <br>
      23. “New Deal.” Encyclopædia Britannica, Encyclopædia Britannica, inc., 29 Mar. 2024, <a href = https://www.britannica.com/event/New-Deal>www.britannica.com</a>. <br>
      24. Oh, Leena. “1988 U.S. Drought/Heatwave.” Homeland Security Digital Library, 17 Apr. 2024, <a href = https://www.hsdl.org/c/timeline/1988-u-s-droughtheatwave/>www.hsdl.org</a>. <br>
      25. “Pure Food and Drug Act.” Encyclopædia Britannica, Encyclopædia Britannica, inc., <a href = https://www.britannica.com/topic/Pure-Food-and-Drug-Act>www.britannica.com</a>. <br>
      26. Richardson, Gary. “The Great Depression.” Federal Reserve History, <a href = https://www.federalreservehistory.org/essays/great-depression#:~:text=1929%E2%80%931941,World%20War%20II%20in%201941>www.federalreservehistory.org</a>. <br>
      27. “A Scientific Revolution: Eugene Funk and Hybrid Corn.” McLean County Museum of History, <a href = https://mchistory.org/digital-exhibits/farming-in-the-great-corn-belt/working-the-land/a-scientific-revolution-eugene-funk-and-hybrid-corn#:~:text=In%201916%20Funks%20produced%20its,shipment%20to%20customers%2C%20circa%201925>mchistory.org</a>. <br>
      28. “Spanish-American War.” Encyclopædia Britannica, Encyclopædia Britannica, inc., 14 Apr. 2024, <a href = https://www.britannica.com/event/Spanish-American-War>www.britannica.com</a>. <br>
      29. “Timeline (1914 - 1921)  :  A World at War  :  Articles and Essays  :  Stars and Stripes: The American Soldiers’ Newspaper of World War I, 1918-1919  :  Digital Collections  :  Library of Congress.” The Library of Congress, <a href = https://www.loc.gov/collections/stars-and-stripes/articles-and-essays/a-world-at-war/timeline-1914-1921/>www.loc.gov</a>. <br>
      30. Timeline of United States History (1900-1929), <a href = https://stateoftheunion.onetwothree.net/timelines/Timeline_US_hist_1900-1929.html>stateoftheunion.onetwothree.net</a>. <br>
      31. United States Holocaust Memorial Museum, United States Holocaust Memorial Museum, <a href = https://encyclopedia.ushmm.org/content/en/article/world-war-ii-key-dates>encyclopedia.ushmm.org</a>. <br>
      32. Verma, Ashish Swarup, et al. “Biotechnology in the Realm of History.” Journal of Pharmacy & Bioallied Sciences, U.S. National Library of Medicine, July 2011, <a href = https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3178936/#:~:text=The%20term%20biotechnology%20was%20used,a%20Hungarian%20Engineer%2C%20in%201919>www.ncbi.nlm.nih.gov</a>. <br>
      33. Weinberg, John. “The Great Recession and Its Aftermath.” Federal Reserve History, <a href = https://www.federalreservehistory.org/essays/great-recession-and-its-aftermath>www.federalreservehistory.org</a>. 
     </font></p>
  </section>
  </body>
</html>