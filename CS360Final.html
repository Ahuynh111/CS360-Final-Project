<!DOCTYPE html>
<html>
  <head>
    <title> CS360 Final Project </title>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-legend/2.25.6/d3-legend.min.js"></script>
    <script src = "https://d3js.org/topojson.v2.min.js"></script>
    <script src="https://unpkg.com/scrollama"
            composer require drupal/scrollama:^1.1>
    </script>

  </head>
  <style type="text/css">
  </style>
  <body>
    <font color = #5C4033>
    <body bgcolor=#CCC5B5>
  <script>
    //page set up 
    const scroll = scrollama();
  </script>
  <section id = "introduction">
    <h1> <center> US Grains - A Visual Exploration</h1>
     <h6>
    <center> 
        University of San Francisco | CS360 Data Visualization Final Project <br>
        Annie Huynh | ahuynh8@dons.usfca.edu | huynhn.annie@gmail.com </em>
  </h6>
    <p> <center>
      This site intends to visualize different metrics on feed grains in the United States. The data spans across roughly 30 years given by the United States Department of Agriculture. While the dataset offers data for a handful of different feed grains, this project will only focus on corn, barley, sorghum, and oats. This project does not intend to completely educate on the United State's feed grain economy, but rather give a very general statistical overview through data visualization. We intend to answer the following:
    </p>
    <p><center>
      1. How have US imports and exports changed across three decades?
      <br>
      2. How have prices changed across three decades?
      <br>
      3. How does growth look like overtime for each grain yield in the US?
      
    </p>
  <h3> <center>About the Data </h3>
  <p><center>
    The data collection is credited to the Economic Research Service of the Department of Agriculture (USDA) who provided the vast database on their website <a href ="https://www.ers.usda.gov/data-products/feed-grains-database/feed-grains-yearbook-tables/#Zipped%20CSV%20files"> USDA Feed Grains: Yearbook Tables </a>. Due to lack of time and project needs, the data used on this site is condensed from the original database through Numbers and cleaned through R-Studio. The original 35 tables have been filtered down into the 12 most relevent.
  </p>
  <p><center>
    Table 1: Farming Information
    <br>
    Tables 4-7: Supply and Disappearance
    <br>
    Tables 9-10: Farmer Prices
    <br>
    Tables 18-19: US Exports
    <br>
    Tables 20-21: US Imports
    <br>
    Table 27: World Imports and Exports
  </p>
  </section>
  <section id = "prices">
    <div id = "pricesDIV"></div>
      <script >
      //Scatter Plot of Pricing Information Over Time
      var svgH = 650;
      var svgW = 1400;
      var margins = {top: 100, bottom: 100, left: 100, right: 100};
      var pad = 50
      var H = 500
      var W = 600

      var svgTime = d3.select("#pricesDIV")
        .append("svg")
        .attr("height", svgH)
        .attr("width", svgW);

      var graphTime = svgTime.append("g")
        .attr("transform", `translate(${margins.left}, ${margins.top})`);

        //Import Data 
        d3.csv('https://raw.githubusercontent.com/Ahuynh111/CS360-Final-Project/main/pricingInformation.csv', function(d){
          return{
            Type: d.type,
            Price: +d.weightedAveragePrice,
            Date: d3.timeParse("%Y")(d.Years)
          };
        }).then(function(d1){
          
        //scales
          var timeScale = d3.scaleTime()
            .domain(d3.extent(d1, function(z){
              return(z.Date)
            }))
            .range([0,W]);

          var priceScale = d3.scaleLinear()
            .domain([0, d3.max(d1, function(z){
              return(z.Price)
            })])
            .range([H,0]);

        //Color and Legend
        var colorScale = d3.scaleOrdinal()
          .domain(["Barley", "Corn", "Oat", "Sorghum"])
          .range(d3.schemeTableau10)

        var legend = d3.legendColor()
          .shape('rect')
          .shapeWidth(10)
          .shapeHeight(10)
          .shapePadding(10)
          .labelOffset(5)
          .labelWrap(30)
          .orient('vertical')
          .scale(colorScale)

        graphTime.append("g")
          .attr("transform", `translate(${W + 50}, ${H - 500})`)
          .call(legend);
            
          //axes
            graphTime.append("g")
              .attr("transform", `translate(0,${H})`)
              .call(d3.axisBottom(timeScale).ticks(10));

            graphTime.append("g")
              .attr("transform", `translate(0,0)`)
              .call(d3.axisLeft(priceScale).ticks(10));


          //tool tips 
          var tool = d3.select("#pricesDIV")
              .data(d1)
              .enter()
              .append("div")
              .style("opacity", 1)
              .attr("class", "tooltip")
              .style("position", "absolute")
              .style("background-color", "#CCC5B5")
              .style("border", "dotted")
              .style("border-color", "#5C4033")
              .style("padding", "10px")
              .style("font-size", "20px")
              .style("color", "#5C4033")

    
          //plotting
          graphTime.selectAll(".circle")
            .data(d1)
            .enter()
            .append("circle")
            .attr("class", "circle")
            .attr("cx", function(z){
              return(timeScale(z.Date))
            })
            .attr("cy", function(z){
              return(priceScale(z.Price))
            })
            .attr("r", 3)
            .attr("fill", function(z){
              return(colorScale(z.Type))
            })
            .on('mouseover', function(z){
                d3.selectAll(".circle")
                  .attr("opacity", 0.25)
                d3.select(this)
                  .attr("r", 8)
                  .attr("opacity", 1)
                tool
                  .style("opacity", 1)
                d3.select(this)
                  .style("visibility", "visible")
                  .html(z.Average)
              })
              .on('mouseout', function(z){
                d3.selectAll(".circle")
                  .attr("opacity", 1)
                d3.select(this)
                  .attr("r", 3)
                tool
                  .style("opacity", 1)
                d3.select(this)
              })
            .on("mousemove", function(e,z){
              condensedDate = String(z.Date).substring(11,15)
              tool
                .html("Average Price of " + z.Type + " in " + condensedDate +": $" + z.Price +"/bushel")
                .style("left", svgW/2 +250 + "px")
                .style("top",  H + 300 + "px")
                .style("opacity", 1)
            })

          //labels
            graphTime.append("text")
              .text("Price")
              .attr("x", -75)
              .attr("y", H/2);
            graphTime.append("text")
              .html("Weighted Average Price Over Time (US Dollar/Bushel)")
              .attr("x", W - 500)
              .attr("y", -30)
      })
      </script>
      <p>The average weighted price for each of the four grains grows exponentially over time. Every grain's price follows the same growth pattern including the peaks at the 1920s, mid 1940s, and the steady growth 1980s onwards. Overall, there is a positive correlation between time and price per bushel increase that is consistent across all grains. This may be correlated to inflating prices in all economic sectors, and insinuates higher demand due to a the evergrowing population.</p>
      <p> The data has been processed through relabelling of years to just reflect the starting year of the agricultural period. The average weighted price per bushel for each grain was selected out of the two tables and combined into one larger csv file in R.</p>
  </section>
  <section id = farming>
    <div id = "farmingDIV">
      <script>
      var svgHFarm = 650;
      var svgWFarm = 1400;
      var margins = {top: 100, bottom: 100, left: 100, right: 100};
      var pad = 50
      var HFarm = 500
      var WFarm = 600

      var svgFarm = d3.select("#farmingDIV")
        .append("svg")
        .attr("height", svgHFarm)
        .attr("width", svgWFarm);

      var graphLine = svgFarm.append("g")
        .attr("transform", `translate(${margins.left}, ${margins.top})`);

      //Import Data --> no Sorghum due to lack of data
        d3.csv('https://raw.githubusercontent.com/Ahuynh111/CS360-Final-Project/main/FarmingInformation.csv', function(d){
          return{
            Yield: +d.yieldBushelsAcre,
            Type: d.type,
            Date: d3.timeParse("%Y")(d.startingYear)
          };
        }).then(function(d1){


          //group data
          groupData = d3.group(d1, function(z){
            return(z.Type)
          })
          

          //scales
          var timelineScale = d3.scaleTime()
            .domain(d3.extent(d1, function(z){
              return(z.Date)
            }))
            .range([0,WFarm]);

          var yieldScale = d3.scaleLinear()
            .domain([0, d3.max(d1, function(z){
              return(z.Yield)
            })])
            .range([HFarm,0]);

        //Color and Legend
        var colorLine = d3.scaleOrdinal()
          .domain(["Barley", "Corn", "Oat"])
          .range(d3.schemeTableau10)

        var legendLine = d3.legendColor()
          .shape('rect')
          .shapeWidth(10)
          .shapeHeight(10)
          .shapePadding(10)
          .labelOffset(5)
          .labelWrap(30)
          .orient('vertical')
          .scale(colorLine)

          //tool tips 
          var toolFarm1 = d3.select("#farmingDIV")
              .data(d1)
              .enter()
              .append("div")
              .style("opacity", 1)
              .attr("class", "tooltip")
              .style("position", "absolute")
              .style("background-color", "#CCC5B5")
              .style("border", "dotted")
              .style("border-color", "#5C4033")
              .style("padding", "10px")
              .style("font-size", "20px")
              .style("color", "#5C4033")

            var toolFarm2 = d3.select("#farmingDIV")
              .data(d1)
              .enter()
              .append("div")
              .style("opacity", 1)
              .attr("class", "tooltip")
              .style("position", "absolute")
              .style("background-color", "#CCC5B5")
              .style("border", "dotted")
              .style("border-color", "#5C4033")
              .style("padding", "10px")
              .style("font-size", "20px")
              .style("color", "#5C4033")

        graphLine.append("g")
          .attr("transform", `translate(${WFarm + 50}, ${HFarm - 500})`)
          .call(legendLine);
            
          //axes
            graphLine.append("g")
              .attr("transform", `translate(0,${HFarm})`)
              .call(d3.axisBottom(timelineScale));

            graphLine.append("g")
              .attr("transform", `translate(0,0)`)
              .call(d3.axisLeft(yieldScale).ticks(10));
    
          //plotting
           var path = d3.line()
              .x(function(z){
                return(xScale(z.Date));
              })
              .y(function(z){
                return(yScale(z.Yield));
              })

            graphLine.selectAll(".line")
              .data(groupData)
              .join("path")
              .attr("year", function(z){
                return z.Date
              })
              .attr("stroke", function(z){
                return colorLine(z[0])
              })
              .attr("stroke-width", 2)
              .attr("d", function(z){
                return d3.line()
                  .x(function(x){
                    return(timelineScale(x.Date))
                  })
                  .y(function(y){
                    return(yieldScale(y.Yield))
                  })
                  (z[1])
              })
              .attr("fill", "none")
              .on('mouseover', function(z){
                d3.selectAll(".line")
                .attr("opacity", 0.25)
                d3.select(this)
                .attr("stroke-width", 3.5)
              })
              .on('mouseout', function(z){
                d3.selectAll(".line")
                  .attr("opacity", 1)
                d3.select(this)
                  .attr("stroke-width", 2)
              })

          //labels
            graphLine.append("text")
              .text("Bushels")
              .attr("x", -85)
              .attr("y", HFarm/2);
            graphLine.append("text")
              .text("Average Yield Over Time (Bushels/Acre)")
              .attr("x", WFarm/2 - 100)
              .attr("y", -30)

          //statement() function --> bring in important dates of that decade

            var currentYear = function(x){
                if (String(timelineScale.invert(x)).substring(11,15) > 2023){
                  return 2023
                }else if(String(timelineScale.invert(x)).substring(11,15) <1865){
                  return 1865
                }else{
                  return(String(timelineScale.invert(x)).substring(11,15))                  }
                }
            const statement = function(v){
              z = currentYear(v)
              if(z>1800 && z <=1880){
                return("pre-1880 List of Historical Events")
              }else if (z > 1880 && z <= 1890){
                return("1880 - 1890 List of Historical Events")
              }else if(z > 1890 && z <= 1900){
                return("1890 - 1900 List of Historical Events")
              }else if(z > 1900 && z <= 1910){
                return("1900 - 1910 List of Historical Events")
              }else if(z > 1910 && z <= 1920){
                return("1910 - 1920 List of Historical Events")
              }else if(z > 1920 && z <= 1930){
                return("1920 - 1930 List of Historical Events")
              }else if(z > 1930 && z <= 1940){
                return("1930 - 1940 List of Historical Events")
              }else if(z > 1940 && z <= 1950){
                return("1940 - 1950 List of Historical Events")
              }else if(z > 1950 && z <= 1960){
                return("1950 - 1960 List of Historical Events")
              }else if(z > 1960 && z <= 1970){
                return("1960 - 1970 List of Historical Events")
              }else if(z > 1970 && z <= 1980){
                return("1970 - 1980 List of Historical Events")
              }else if(z > 1980 && z <= 1990){
                return("1980 - 1990 List of Historical Events")
              }else if(z > 1990 && z <= 2000){
                return("1990 - 2000 List of Historical Events")
              }else if(z > 2000 && z <= 2010){
                return("2000 - 2010 List of Historical Events")
              }else if(z > 2010 && z <= 2020){
                return("2010 - 2020 List of Historical Events")
              }else if(z > 2020){
                return("2020+ List of Historical Events")
              }
            }



          //line interaction
            const line = graphLine.append("line")
              .attr("stroke", "#5C4033")
              .attr("stroke-width", 4)
              .attr("opacity", "0.5")
              .attr("x1", 0)
              .attr("x2", 0)
              .attr("y1", 0)
              .attr("y2", HFarm)
              .call(d3.drag().on("drag", function(z){
                  line.attr("x1", function(){
                    if (z.x > WFarm){
                      return WFarm
                    }else if(z.x < 0){
                      return 0
                    }else{
                      return z.x
                    }
                  })
                  line.attr("x2", function(){
                    if (z.x > WFarm){
                      return WFarm
                    }else if(z.x < 0){
                      return 0
                    }else{
                      return z.x
                    }
                  })
                  toolFarm1
                    .html("Current Year: " + currentYear(z.x)) 
                    .style("left", svgWFarm/2 +350 + "px")
                    .style("top",  HFarm + 1100 + "px")
                    .style("opacity", 1)
                  toolFarm2
                    .html(statement(z.x))
                    .style("left", svgWFarm/2 +300 + "px")
                    .style("top",  HFarm + 1200 + "px")
                    .style("opacity", 1)
                }))
        })
      </script>
      <p>Average Yield over time has a positive correlation starting at about the 1960s and onwards. We can see a generally positive growth trend for all grain yields included. At the data's earliest in the 1800s to the beginning of the 1960s, we cann see that grain yiels stayed at about twenty to thirty bushels per acre. However, this may due to lack of data or lack of quality data collection. Interestingly, grain yield for corn grew the most and had the steepest trend overall. Barley and oats followed one another very closely. Sorghum was ommited from this chart due to lack of data.</p>
  </section>
  <section id = ie>
    <div id = "ieDIV">
      <script>
      //Bar Chart of US Imports and US Exports 
      var svgHBar = 550;
      var svgWBar = 1400;
      var marginsBar = {top: 100, bottom: 100, left: 100, right: 100};
      var HBar = 250
      var WBar = 1000
      var padding = 50;

      var svgBar = d3.select("#ieDIV")
        .append("svg")
        .attr("height", svgHBar)
        .attr("width", svgWBar);

      var graphBar = svgBar.append("g")
        .attr("transform", `translate(${marginsBar.left + 75},${marginsBar.top})`);
          //Import Data
        d3.csv('https://raw.githubusercontent.com/Ahuynh111/CS360-Final-Project/main/Exports.csv', function(d){
          return{ 
            Date: d3.timeParse("%Y")(d.Years),
            Annual: +d.Annual,
            Type: d.type
          };
        }).then(function(d1){
          d3.csv(`https://raw.githubusercontent.com/Ahuynh111/CS360-Final-Project/main/Imports.csv`, function(t){
            return{
              Date: d3.timeParse("%Y")(t.Years),
              Annual: +t.Annual,
              Type: t.type
            }
          }).then(function(t1){


          //scales
           // Y-axis - Grain type
            grainScale = d3.scaleBand()
              .domain(d1.map(function(z){
                return(z.Type)
              }))
              .range([0,HBar]);

            //Exports
              exportScale = d3.scaleLinear()
                .domain([0, d3.max(d1, function(z){
                  return(z.Annual)
                })])
                .range([0, WBar/2]);

            //Imports 
              importScale = d3.scaleLinear()
                .domain([0, d3.max(t1, function(z){
                  return(z.Annual)
                })])
                .range([0, WBar/2]);

          //append axes
               //exports
            graphBar.append("g")
              .attr("transform", `translate(0, 0)`)
              .call(d3.axisLeft(grainScale));

            graphBar.append("g")
              .attr("transform", `translate(0, ${HBar})`)
              .call(d3.axisBottom(exportScale).ticks(5));

              //imports
            graphBar.append("g")
              .attr("transform", `translate(${WBar/2+ padding}, 0)`)
              .call(d3.axisLeft(grainScale));

           graphBar.append("g")
              .attr("transform", `translate(${WBar/2 + padding}, ${HBar})`)
              .call(d3.axisBottom(importScale).ticks(5));


            //initial current year
            var current = "1990" //default to 1990

                //exports
                  filteredExportData = d1.filter(function(z){
                    if(String(z.Date).substring(11,15) == current){
                      return(z)
                    }
                  })
                  var exportsBars = graphBar.selectAll(".rectExport")
                    .data(filteredExportData)
                    .enter()
                    .append("rect")
                    .attr("class", "rectExport")
                    .attr("x", 0)
                    .attr("y", function(z){
                      return(grainScale(z.Type))
                    })
                    .attr("height", 50)
                    .attr("width", function(z){
                      return(exportScale(z.Annual))
                    })
                    .attr("fill", "#5C4033")

                //imports
                  filteredImportData = t1.filter(function(z){
                    if(String(z.Date).substring(11,15) == current){
                      return(z)
                    }
                  })
                  var importsBars = graphBar.selectAll(".rectImport")
                    .data(filteredImportData)
                    .enter()
                    .append("rect")
                    .attr("class", "rectImport")
                    .attr("x", WBar/2 + padding)
                    .attr("y", function(z){
                      return(grainScale(z.Type))
                    })
                    .attr("height", 50)
                    .attr("width", function(z){
                      return(importScale(z.Annual))
                    })
                    .attr("fill", "#5C4033")


            //redrawing when current year changes
            const redraw = function(x){
              filteredExportData = d1.filter(function(z){
                if(String(z.Date).substring(11,15) == x){
                  return(z)
                }
              })
              filteredImportData = t1.filter(function(z){
                if(String(z.Date).substring(11,15) == x){
                  return(z)
                }
              })

              graphBar.selectAll(".rectExport").remove()
              var exportsBars = graphBar.selectAll(".rectExport")
                    .data(filteredExportData)
                    .enter()
                    .append("rect")
                    .attr("class", "rectExport")
                    .attr("x", 0)
                    .attr("y", function(z){
                      return(grainScale(z.Type))
                    })
                    .attr("height", 50)
                    .attr("width", function(z){
                      return(exportScale(z.Annual))
                    })
                    .attr("fill", "#5C4033")
              graphBar.selectAll(".rectImport").remove()
              var importsBars = graphBar.selectAll(".rectImport")
                    .data(filteredImportData)
                    .enter()
                    .append("rect")
                    .attr("class", "rectImport")
                    .attr("x", WBar/2 + padding)
                    .attr("y", function(z){
                      return(grainScale(z.Type))
                    })
                    .attr("height", 50)
                    .attr("width", function(z){
                      return(importScale(z.Annual))
                    })
                    .attr("fill", "#5C4033")
            }

            //year sliding tools
            var time = d3.scaleTime()
              .domain(d3.extent(d1, function(z){
                return (z.Date)
              }))
              .range([svgWBar/4, svgWBar/2])

            var currentYear = function(x){
                if(String(time.invert(x)).substring(11,15) > 2023){
                  return 2023
                }else if(String(time.invert(x)).substring(11,15) < 1990){
                  return 1990
                }else{
                  return String(time.invert(x)).substring(11,15)
                }
              }

            graphBar.append("g")
              .attr("transform", `translate(${svgWBar - 1400}, 400)`)
              .call(d3.axisBottom(time).ticks(4));

            //yearLabel
            var yearLabel = d3.select("#ieDIV")
              .append("div")
              .style("opacity", 1)
              .attr("class", "tooltip")
              .style("position", "absolute")
              .style("background-color", "#CCC5B5")
              .style("border", "dotted")
              .style("border-color", "#5C4033")
              .style("padding", "10px")
              .style("font-size", "20px")
              .style("color", "#5C4033")
              .html(current)
              .style("left", svgWBar/2 - 25 + "px")
              .style("top",  2450 + "px")

            const circle = graphBar.append("circle")
              .attr("stroke", "#5C4033")
              .attr("r", 4)
              .attr("cx", svgWBar/4)
              .attr("cy", 400)
              .call(d3.drag().on("drag", function(z){
                  circle.attr("cx", function(){
                    if (z.x > svgWBar/2 ){
                      return svgWBar/2
                    }else if(z.x < svgWBar/4){
                      return svgWBar/4
                    }else{
                      return z.x
                    }
                  })
                current = currentYear(z.x)
                yearLabel
                  .html(current)
                redraw(current)
                }))


          //labels
            graphBar.append("text")
              .text("Exports From US")
              .attr("x", WBar - 800)
              .attr("y", -20)
           graphBar.append("text")
              .text("Total Bushels")
              .attr("x", WBar - 800)
              .attr("y", HBar + 75)

            graphBar.append("text")
              .text("Imports to US")
              .attr("x", WBar - 225)
              .attr("y", -20)

            graphBar.append("text")
              .text("Total Bushels")
              .attr("x", WBar - 225)
              .attr("y", HBar + 75)
          })
        })
      </script>

      <p>On the left we have exports of each grain from the US, and on the right, we have imports of each grain to the US. Both data sets include data from 1990 to the most recent recorded year 2023. Starting with exports, we can see that corn is the leading exported grain across every recorded year. In 1991, corn exports grew tremendously, and have since generally continued to grow with a bit of fluctuation. All other grains fluctuate as well. However, none come close to the growth of corn and stay below 500,000,000 total bushels across all three decades. Following corn, sorghum generally remains the second highest exported grain with barley and oats trailing behind respectively. 
      </p>
      <p>
        As for the imports side, we see a completely opposite trend, as expected. Oats, generally remains the highest imported grain across all decades. Most likely due to the lack of supply as indicated by little to no oat exports. Corn and barley, respectively, follow oats in total number of bushel imports. Interstingly, corn is the highest recorded imports in 2012, but quickly falls behind oats again in the following years. Sorghum also remains the lowest number of imports overtime as it did for exports. This may be due to the lack of sorghum consumed/demanded in the US.
      </p>
      <p>
        Looking above to the yield chart, we can see why corn is the highest in exports. Corn yield had the highest growth above barley and oat. Barley and oats had very similar yields and relatively stay similar in terms of exports. 
      </p>
  </section>
  <section id = map>
    <div id = mapDIV>
      <script>
      var svgHMap = 800;
      var svgWMap = 1400;
      var marginsMap = {top: 100, bottom: 100, left: 150, right: 100};
      var HMap = 500
      var WMap = 1200

      var svgMap = d3.select("#mapDIV")
        .append("svg")
        .attr("height", svgHMap)
        .attr("width", svgWMap);

      var graphMap = svgMap.append("g")
        .attr("transform", `translate(${-marginsMap.left/2},${marginsMap.top})`);
          //Import Data
        d3.csv('https://raw.githubusercontent.com/Ahuynh111/CS360-Final-Project/main/barleyWorldExports.csv', function(d){
          return{ 
            Exports: +d.Exports,
            Country: d.Country, 
            Date: d.Year
          };
        }).then(function(d1){

          //filtering data
          filteredData = d1.filter(function(z){
              if(z.Date == "2023"){
                return(z)
              }
            })

          var map = new Map();
          const projection = d3.geoAlbers().scale(100).center([0,100])
          const path = d3.geoPath().projection(projection)
          filteredData.forEach(function(z){
            map.set(z.Country, z.Exports)
          })

          console.log(map)
          //color scale
          const colorMap = d3.scaleThreshold()
              .domain([0,2000,4000,6000,8000])
              .range(d3.schemeGreens[5])

          d3.json("https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json").then(create);

          //creating map
          function create(v){
            console.log(v)
            graphMap.append("g")
            .selectAll("path")
            .data(topojson.feature(v, v.objects.countries).features)
            .enter()
            .append("path")
            .attr("stroke", "#5C4033")
            .attr("fill", function(z){
              return colorMap(z.Exports = map.get(z.properties.name))
            })
            .attr("d", path)
          }

          //color legend 
          var legend = d3.legendColor()
              .shapeWidth(20)
              .shapeHeight(20)
              .shapePadding(0)
              .orient("vertical")
              .scale(colorMap);
              
            graphMap.append("g")
              .attr("transform", `translate(${WMap},${HMap/4})`)
              .call(legend);
          
          //labels
          graphMap.append("text")
            .text("2023 Barley Exports to the US (Select Countries in 1000 Metric Tons)")
            .attr("x", svgW/2 - 100)
            .attr("y", -30)        
        })
      </script>
  </section>
  <section id = cornHeat>
      <div id = "cornHeatDiv">
        <script>
          var svgHHeat = 650;
          var svgWHeat = 1400;
          var marginsHeat = {top: 100, bottom: 100, left: 150, right: 100};
          var HHeat = 500
          var WHeat = 1200

          var svgHeat = d3.select("#cornHeatDiv")
            .append("svg")
            .attr("height", svgHHeat)
            .attr("width", svgWHeat);

          var graphHeat = svgHeat.append("g")
            .attr("transform", `translate(${-marginsHeat.left/2},${marginsHeat.top})`);

          //Import Data
        d3.csv('https://raw.githubusercontent.com/Ahuynh111/gist-practice/main/cornWorldExports.csv', function(d){
          return{ 
            Exports: +d.Exports,
            Country: d.Country, 
            Date: d.Year
          };
        }).then(function(d1){

          //filtering data 
          filteredData = d1.filter(function(z){
              if(z.Date > 1990 && z.Country != "Total"){
                return(z)
              }
            })
          console.log(filteredData);

          //scales
            var exportCorn = d3.scaleBand()
            .domain(filteredData.map(function(z){
              return(z.Date)
            }))
            .range([20,svgWHeat - 350]);

            var country = d3.scaleBand()
            .domain(filteredData.map(function(z){
              return(z.Country)
            }))
            .range([HHeat,0]);

          //axes
            graphHeat.append("g")
              .attr("transform", `translate(200,${HHeat})`)
              .call(d3.axisBottom(exportCorn).ticks(12));

            graphHeat.append("g")
              .attr("transform", `translate(220,0)`)
              .call(d3.axisLeft(country).ticks(10));

          //color scale
            var colorScale = d3.scaleSequential(d3.interpolateOranges)
              .domain([d3.min(filteredData, function(z){
                return(z.Exports);
              }), d3.max(filteredData, function(z){
                return(z.Exports)
              })]);

          //color legend
            var legend = d3.legendColor()
              .shapeWidth(10)
              .shapeHeight(10)
              .shapePadding(5)
              .labelFormat(".0f")
              .labelOffset(5)
              .title("1000 metric tons")
              .orient("vertical")
              .scale(colorScale);
              
            graphHeat.append("g")
              .attr("transform", `translate(${svgWHeat - 80},150)`)
              .call(legend);

          //tooltips
            var cornTool = d3.select("#cornHeatDiv")
              .append("div")
              .style("opacity", 1)
              .attr("class", "tooltip")
              .style("position", "absolute")
              .style("background-color", "#CCC5B5")
              .style("border", "dotted")
              .style("border-color", "#5C4033")
              .style("padding", "10px")
              .style("font-size", "20px")
              .style("color", "#5C4033")


          //plotting
            graphHeat.selectAll(".rect")
              .data(filteredData)
              .enter()
              .append("rect")
              .attr("class", "rect")
              .attr("x", function(z){
                return(exportCorn(z.Date))
              })
              .attr("y", function(z){
                return(country(z.Country))
              })
              .attr("width",exportCorn.bandwidth() - 2)
              .attr("height",country.bandwidth() - 2)
              .attr("transform", `translate(201,0)`)
              .attr("fill", function(z){
                return(colorScale(z.Exports))
              })
              .on('mouseover', function(z){
                cornTool
                .style("opacity", 1)
                d3.select(this)
                .style("visibility", "visible")
                .html(z.Country)
              })
              .on('mouseout', function(z){
                cornTool
                .style("opacity", 0)
                d3.select(this)
              })
              .on('mousemove', function(e, z){
                cornTool
                .html("<center>" + z.Date  + " </center> " + z.Country + ":  "+ z.Exports)
                .style("left", (e.x + 20) + "px")
                .style("top", (e.y + 3450) + "px")
              })

              //labels
            svgHeat.append("text")
              .text("Country")
              .attr("x", 20)
              .attr("y", svgHHeat/2);
            svgHeat.append("text")
              .text("Corn Exports (1000 Metric Tons) - Select Countries")
              .attr("x", WHeat/2 - 100)
              .attr("y", 50)
        })
        </script>
        <p>
          Continuing with the United State's significance in corn exports, we decided to show where the US stands amongst select countries over time. We can see that the United States dominates above the other countries, and have primarily been the leading exporter since 1990s. However, this may be due to lack of data collection ability overseas 30 years ago. We can see that beginning in 2012, Brazil, Ukraine, and Argentina increase exports. While they don't match with the United States, we can expect a closer competition in future years as there seems to be a positive correlation with exports and each consecutive year.
        </p>
  </section>
  </body>
</html>